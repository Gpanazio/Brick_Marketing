<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRICK AI ‚Äî Ranking de Modelos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <style>
        @font-face {
            font-family: 'BrickFont';
            src: local('Inter'), local('Helvetica Neue');
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: #000;
            color: #fff;
        }

        .font-brick {
            font-family: 'BrickFont', 'Inter', sans-serif;
            font-weight: 900;
            letter-spacing: -0.03em;
        }

        .bar-a {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }

        .bar-b {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .bar-c {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .glow-a {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .glow-b {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .glow-c {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        .bar-track {
            background: #111;
            height: 32px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            min-width: 40px;
        }

        .crown {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-4px);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .detail-row:hover {
            background: #0a0a0a;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- HEADER -->
    <header class="border-b border-white/5 p-8 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-brick uppercase tracking-tighter">
                BRICK AI <span class="text-[#DC2626]">RANKING</span>
            </h1>
            <p class="text-[9px] text-[#555] tracking-[0.3em] mt-1">MODEL A√óB√óC LEADERBOARD</p>
        </div>
        <a href="/"
            class="text-[9px] text-[#555] border border-[#222] px-4 py-2 hover:border-white hover:text-white transition-all uppercase tracking-wider">
            ‚Üê War Room
        </a>
    </header>

    <!-- CONTENT -->
    <main class="max-w-5xl mx-auto p-8">
        <div id="loading" class="text-center py-20">
            <div class="text-[#555] text-sm">Carregando dados...</div>
        </div>

        <div id="content" class="hidden">
            <!-- MARKETING SECTION -->
            <section id="section-marketing" class="mb-20 fade-in" style="animation-delay: 0.1s">
                <div class="flex items-center gap-4 mb-8">
                    <h2 class="text-xl font-brick uppercase text-[#DC2626]">Marketing Pipeline</h2>
                    <span class="text-[9px] text-[#444] tracking-widest">COPYWRITER A√óB√óC</span>
                </div>
                <div class="text-[9px] text-[#555] mb-6" id="marketing-total"></div>

                <div class="space-y-4 mb-10" id="marketing-bars"></div>

                <!-- Detail table -->
                <div class="border border-[#111] mt-8">
                    <div
                        class="text-[9px] text-[#444] tracking-widest uppercase p-4 border-b border-[#111] flex justify-between">
                        <span>Hist√≥rico de batalhas</span>
                        <button onclick="toggleDetails('marketing')" class="text-[#555] hover:text-white transition-all"
                            id="marketing-toggle">‚ñ∏ Mostrar</button>
                    </div>
                    <div id="marketing-details" class="hidden"></div>
                </div>
            </section>

            <!-- PROJETOS SECTION -->
            <section id="section-projetos" class="mb-20 fade-in" style="animation-delay: 0.3s">
                <div class="flex items-center gap-4 mb-8">
                    <h2 class="text-xl font-brick uppercase text-[#f59e0b]">Projetos Pipeline</h2>
                    <span class="text-[9px] text-[#444] tracking-widest">CREATIVE IDEATION A√óB√óC</span>
                </div>
                <div class="text-[9px] text-[#555] mb-6" id="projetos-total"></div>

                <div class="space-y-4 mb-10" id="projetos-bars"></div>

                <div class="border border-[#111] mt-8">
                    <div
                        class="text-[9px] text-[#444] tracking-widest uppercase p-4 border-b border-[#111] flex justify-between">
                        <span>Hist√≥rico de batalhas</span>
                        <button onclick="toggleDetails('projetos')" class="text-[#555] hover:text-white transition-all"
                            id="projetos-toggle">‚ñ∏ Mostrar</button>
                    </div>
                    <div id="projetos-details" class="hidden"></div>
                </div>
            </section>

            <!-- EMPTY STATE -->
            <div id="empty-state" class="hidden text-center py-20">
                <div class="text-4xl mb-4">ü§ñ</div>
                <h3 class="font-brick text-lg text-[#555] uppercase mb-2">Sem batalhas ainda</h3>
                <p class="text-[9px] text-[#444] tracking-widest">Execute pipelines com A√óB√óC para gerar dados de
                    ranking.</p>
            </div>
        </div>
    </main>

    <script>
        function toggleDetails(mode) {
            const el = document.getElementById(`${mode}-details`);
            const btn = document.getElementById(`${mode}-toggle`);
            el.classList.toggle('hidden');
            btn.textContent = el.classList.contains('hidden') ? '‚ñ∏ Mostrar' : '‚ñæ Esconder';
        }

        function renderBars(containerId, data) {
            const container = document.getElementById(containerId);
            const variants = ['A', 'B', 'C'];
            const colors = { A: 'a', B: 'b', C: 'c' };
            const maxPct = Math.max(
                parseFloat(data.percentages.A) || 0,
                parseFloat(data.percentages.B) || 0,
                parseFloat(data.percentages.C) || 0
            );
            const winnerVariant = variants.reduce((best, v) =>
                data.tally[v] > data.tally[best] ? v : best, 'A');

            container.innerHTML = variants.map(v => {
                const model = data.models[v] || {};
                const pct = parseFloat(data.percentages[v]) || 0;
                const count = data.tally[v] || 0;
                const isWinner = v === winnerVariant && count > 0;
                const color = colors[v];

                return `
                    <div class="flex items-center gap-4 ${isWinner ? `glow-${color} border border-${color === 'a' ? 'blue-500/30' : color === 'b' ? 'green-500/30' : 'yellow-500/30'} p-3 -mx-3` : ''}">
                        <div class="w-24 flex items-center gap-2">
                            ${isWinner ? '<span class="crown text-lg">üëë</span>' : '<span class="w-6"></span>'}
                            <div>
                                <div class="text-sm font-bold text-white">${model.label || v}</div>
                                <div class="text-[8px] text-[#555]">${model.style || ''}</div>
                            </div>
                        </div>
                        <div class="flex-1 bar-track">
                            <div class="bar-fill bar-${color}" style="width: ${Math.max(pct, 2)}%">
                                <span class="text-[10px] font-bold text-black">${pct}%</span>
                            </div>
                        </div>
                        <div class="w-16 text-right">
                            <span class="text-lg font-bold">${count}</span>
                            <span class="text-[9px] text-[#555]"> wins</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderDetails(containerId, details, models) {
            const container = document.getElementById(containerId);
            if (!details || details.length === 0) {
                container.innerHTML = '<div class="p-4 text-[9px] text-[#444]">Sem dados</div>';
                return;
            }

            container.innerHTML = details.map((d, i) => {
                const model = models[d.winner?.charAt(0)] || {};
                const date = d.timestamp ? new Date(d.timestamp).toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }) : '‚Äî';
                return `
                    <div class="detail-row flex items-center gap-4 px-4 py-3 border-b border-[#0a0a0a] text-[10px] transition-all">
                        <span class="text-[#333] w-8">#${i + 1}</span>
                        <span class="text-[#555] w-16">${date}</span>
                        <span class="font-bold ${d.winner?.charAt(0) === 'A' ? 'text-blue-400' : d.winner?.charAt(0) === 'B' ? 'text-green-400' : 'text-yellow-400'} w-20">
                            ${model.label || d.winner} (${d.winner})
                        </span>
                        <span class="text-[#444] w-16">${d.score ? `Score: ${d.score}` : ''}</span>
                        <span class="text-[#333] flex-1 truncate">${d.jobId?.substring(0, 13) || ''}</span>
                    </div>
                `;
            }).join('');
        }

        async function loadRanking() {
            try {
                const res = await fetch('/api/ranking');
                const data = await res.json();

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');

                const mktData = data.marketing;
                const projData = data.projetos;
                const hasData = (mktData?.total || 0) + (projData?.total || 0) > 0;

                if (!hasData) {
                    document.getElementById('empty-state').classList.remove('hidden');
                    document.getElementById('section-marketing').classList.add('hidden');
                    document.getElementById('section-projetos').classList.add('hidden');
                    return;
                }

                if (mktData && mktData.total > 0) {
                    document.getElementById('marketing-total').textContent = `${mktData.total} batalha${mktData.total > 1 ? 's' : ''} registrada${mktData.total > 1 ? 's' : ''}`;
                    renderBars('marketing-bars', mktData);
                    renderDetails('marketing-details', mktData.details, mktData.models);
                } else {
                    document.getElementById('section-marketing').classList.add('hidden');
                }

                if (projData && projData.total > 0) {
                    document.getElementById('projetos-total').textContent = `${projData.total} batalha${projData.total > 1 ? 's' : ''} registrada${projData.total > 1 ? 's' : ''}`;
                    renderBars('projetos-bars', projData);
                    renderDetails('projetos-details', projData.details, projData.models);
                } else {
                    document.getElementById('section-projetos').classList.add('hidden');
                }
            } catch (e) {
                document.getElementById('loading').innerHTML = `<div class="text-red-500 text-sm">Erro ao carregar ranking: ${e.message}</div>`;
            }
        }

        loadRanking();
    </script>
</body>

</html>